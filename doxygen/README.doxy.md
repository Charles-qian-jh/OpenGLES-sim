# OpenGL ES 2.0 Simulator # {#mainpage}

\image html banana.jpg
\image html teapot.jpg
\image html stone_floor.jpg
\image html cubemap.jpg
\image html cubemap_inside.jpg
\image html FourShape1_POM_w_self_shadow.jpg

[TOC]

Intorduction {#introduction}
============
This project's main purpose is to create a sophisticated GPU simulator based on OpenGL ES 2.0. It's also my personal OpenGL ES playing and learning ground :).

Currently it has features listed below
- Using [NVGP4](https://www.opengl.org/registry/specs/NV/gpu_program4.txt) as shader assembly language.
- Custom OpenGL context management system
  + To preserve OpenGL state, include the shader source and shader symbol table.
  + Texture memory optimization by using [6D blocked organization](graphics.stanford.edu/papers/texture_prefetch/texture_prefetch_comp.pdf)
- Using [Sutherland-Hodgman Polygon Clipping Algorithm](http://en.wikipedia.org/wiki/Sutherland%E2%80%93Hodgman_algorithm) to clip
- Tile-based subdivision triangle tranversal method.
    + Based on [the algorithm in Intel Larrabee](https://software.intel.com/en-us/articles/rasterization-on-larrabee). This method also works well with the concept of block based texture memory organization.
- Barycentric triangle attribute interpolation.
- Support Anisortrpic texture filter.
- Configuable texture cache 
    + Take advantage of 6D blocked texture image optimization method
    + Connected with a realistic DRAM-timinig model which let me probe the effect between different texture parameters.
- Hardware normal vector interpolation. 
    + Try to decrease shader loading but needs OpenGL compiler's support. To enable this feature for now, the modification of assembly code generated by cg compiler is requried.


* * *

Compile Requirement {#compile_required}
===================
- GCC: 4.6.4 or above with c++11(c++0x) support
  + [MinGW-builds](http://sourceforge.net/projects/mingwbuilds/) (Windows)
  + With Code::Blocks built-in mingw-gcc (Windows)
  
    There is a bug caused by Mingw-gcc 4.6.4-4.7.2 on Windows. Please see the
    [issue section](#known_issue) for the solution by patching or updating 
    Mingw-gcc.
	
  + On most Linux distribution, Update to gcc 4.6.4 or above should be a piece 
    of cake :)

	If you are using RedHat or CentOS earlier than version 6.5, please 
	follow this [page](http://people.centos.org/tru/devtools-1.1/readme) to 
	add the updatedi gcc into the independent environment.
  
  
- [Nvidia Cg Toolkits](https://developer.nvidia.com/cg-toolkit-download)
  (Both Windows and Linux)
  
  Current version uses cg compiler as its glsl compiler. Lack of this compiler
  will cause glCompilerShader malfunction, although you can use glShaderBinary
  to avoid it. Note: glShaderBinary in this environeent actually reads nvgp4
  assembly code in text file instead of real binary file.
	
	
- [Code::Blocks](http://www.codeblocks.org/downloads) (Both Windows and 
  Linux)
	
  The whole project is managed by this IDE, but you can still use custom 
  Makefile or use cbp2make converting .cbp to Makefile for yout comfortable.
  
  
- Flex & Bison (optional)
  + Use [MSYS](http://www.mingw.org/wiki/MSYS) (Windows, recommend)
  + [win flex-bison](http://sourceforge.net/projects/winflexbison/) (Windows)
  + These tools on Linux are built-in. :)

  The assembly grammar and token is defined in .y and .l file and need Flex & 
  Bison to generate C code for compiling. Although these generated C code
  already attached within the project and you can compile them with no problem,
  you still need these tools if you want to adjust the grammar.

* * *
  
How to get this project {#how_to_get_this_project}
=======================

Use these git commands to get the code from github or my git server

	git clone git://lioujheyu.synology.me/ogles-sim.git

	git clone git://github.com/lioujheyu/OpenGLES-sim.git
	
If you are a contributor and have my git server permission, please use this
	
	git clone git@lioujheyu.synology.me:ogles-sim

Afterwards, download OpenGL Mathmatical library by using git submodule

	git submodule update --init --recursive

Or you can directly go to https://github.com/g-truc/glm to download and put it manually into external/glm/
	
You can use any git client to execute the above commands. If on Windows, go checking [MsysGit](http://msysgit.github.io/), [TortoiseGit](https://code.google.com/p/tortoisegit/), or even Msys/Cygwin with git.

You can also come to [my git server](http://lioujheyu.synology.me/~git/index.cgi/ogles-sim.git/), click the newest commit version in main branch, and download whole project by click the downlink link on the top of page. This site also allows anyone to trace the the project's current progress.

* * *

How to Compile this project {#how_to_compile_this_project}
===========================

- Use Code::Blocks
  
  Direcly open **ogles-sim.cbp** in codeblocks and push Ctrl-F9 (compile). If you
  have right gcc version or pathced mingw-gcc and correct toolchain setting in 
  codeblocks compiler setting page, there shall be no problem.

  Once if the project is compiled, hit F9 to run this project. the result image
  will be generated as colormap.bmp in project root.

- Makefile

  If you prefer to use unix build system, **cbp2make** will do you a favor but you
  need to compile this tool from source. You can get its source from [here]
  (http://sourceforge.net/projects/cbp2make/)
	
  After cbp2make binary is ready, type
  
		cbp2make -in ogles-sim.cbp -out Makefile //Generate Makefile
		make all                                 //Compile

  You still need to check you compiler's version if you encounter any standard
  library's problem.

  After compile is finished, you will see the binary called ogles-sim. Just execute it and then you will found The result image generated as colormap.bmp under root directory.

Besides, there is a single, independent Makefile under 'src' directory which is used to generated assembler's C code from .y and .l file. You can use it after the .l and .y file are modified. ( However, this operation needs make tool and flex/bison. If on windows, the most convenient way I know is to use msys/cygwin system to make this Makefile )

* * *

Configuration {#configuration}
=============
All benchmarks and settings are inside the simulator code, which means each time you modified them will request to recompile the project. Because the OpenGL runtime is not yet implemented into a library, the build-in benchmarks are inside main.cpp for now and can be enable or diable by comment the function call in main function.

As configuration, all settings are put in gpu_config.h as marco define. The detailed description can be found in gpu_config.h page.

* * *

Major File Association {#basic_file_association}
======================
All files outside the *src* such as main.cpp and other filed in *external*
are used as OpenGL Application, not the part of my simulator. They are only
worked as the testbench. 
\dot
digraph {
	node [ fontname=arial, fontsize=11, shape=record ];
	edge [ color=blue ];
	"main.cpp" [URL="\ref main.cpp"];
	"gl3.h" [URL="\ref gl3.h", 
			 shape=ellipse];
	"gl3.cpp" [URL="\ref gl3.cpp"]
	"context.h" [URL="\ref context.h",
				 shape=ellipse];
	"context.cpp" [URL="\ref context.cpp"]
	context_glapi [label="{context_glapi.cpp|{DrawArray()}}", 
				   URL="\ref Context::DrawArrays()"];
	"context_shader_glapi.cpp" [URL="\ref context_shader_glapi.cpp"]
	"context_link.cpp" [URL="\ref context_link.cpp"];
	driver [label="{driver.cpp|{ActiveGPU()}}", 
			URL="\ref ActiveGPU()"];
	"driver.h" [URL="\ref driver.h",
				shape=ellipse];
	"gpu_core.h" [URL="\ref gpu_core.h",
				  shape=ellipse];
	"gpu_core.cpp" [URL="\ref gpu_core.cpp"];
	"shader_core.h" [URL="\ref shader_core.h",
					 shape=ellipse];
	"shader_core.cpp" [URL="\ref shader_core.cpp"];
	"geometry.cpp" [URL="\ref geometry.cpp"];
	"rasterizer.cpp" [URL="\ref rasterizer.cpp"];
	"texture_unit.h" [URL="\ref texture_unit.h",
					  shape=ellipse];
	"texture_unit.cpp" [URL="\ref texture_unit.cpp"];
	"dram.h" [URL="\ref dram.h",
					  shape=ellipse];
	"dram.cpp" [URL="\ref dram.cpp"];
	
	"main.cpp" -> {"gl3.h" "gl3.cpp"};
	"gl3.cpp" -> {"context.h" "context.cpp" context_glapi
				 "context_shader_glapi.cpp" "context_link.cpp"};
	"context_link.cpp" -> {"nvgp4info.l" "nvgp4info.y" 
						   "nvgp4ASM.l" "nvgp4ASM.y"};
	context_glapi -> {driver "driver.h"};
	driver -> {"gpu_core.h" "gpu_core.cpp"};
	"gpu_core.cpp" -> {"shader_core.h" "shader_core.cpp" 
					   "geometry.cpp" "rasterizer.cpp"
					   "dram.cpp"};
	"shader_core.cpp" -> {"texture_unit.h" "texture_unit.cpp"};
	"texture_unit.cpp" -> {"dram.cpp" "dram.h"}
					
}
\enddot

* * *

Known Compile Issue {#known_issue}
===========

- While compile the code on windows, the compile error **std::to_string is not
  a member of std** is jumped out.
	
  This is a known bug for mingw-gcc from 4.6.4 to 4.7.2. You can update your 
  Mingw-gcc by [MinGW-builds](http://sourceforge.net/projects/mingwbuilds/files/).
  After you installed newer Mingw-gcc, make sure you have alredy change the
  codeblocks compiler toolchain setting before compile the code.
  
  Their is another way to solve it by patching your Mingw-gcc from this [site]
  (http://tehsausage.com/mingw-to-string). You may find your Mingw-gcc under
  `C:\Program Files (x86)\CodeBlocks\MinGW` (If you use the codeblocks' bundled 
  gcc) or `C:\MinGW` . Follow the step on the web site with no additional work 
  should fix this problem.

The other project related issue may found in todo list.

* * *

Cause this project is still under development, any unexpected situation is possible. Please email or report to me if you find any compiler error or bug.

	
Liou Jhe-Yu <br>
lioujheyu@gmail.com <br>
National Cheng-kung University, EE Department, <br>
[Computer Architecture and System Laboratory]
(http://caslab.ee.ncku.edu.tw/index.html) <br>
Tainan, Taiwan <br>
2013/6/30 <br>
2013/8/16 1st update <br>
2013/9/25 2nd update <br>
2014/7/23 3rd update <br>
2014/12/18 4rd update
